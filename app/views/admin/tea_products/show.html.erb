<h2 class="text-2xl font-bold mb-6">
  TeaProduct 承認詳細
</h2>

<div class="bg-white border rounded-lg p-6 space-y-6">

  <!-- 基本情報 -->
  <div>
    <h3 class="text-lg font-semibold mb-2">基本情報</h3>

    <div class="mb-4">
      <% if @tea_product.image.attached? %>
        <%= image_tag @tea_product.image, class: "w-64 h-64 object-cover rounded-lg" %>
      <% else %>
        <div class="w-64 h-64 bg-gray-100 border rounded-lg flex items-center justify-center">
          <span class="text-gray-400">画像なし</span>
        </div>
      <% end %>
    </div>

    <dl class="grid grid-cols-1 sm:grid-cols-2 gap-x-8 gap-y-4 text-sm">
      <div>
        <dt class="text-gray-500">商品名</dt>
        <dd class="font-medium"><%= @tea_product.name %></dd>
      </div>

      <div>
        <dt class="text-gray-500">投稿者</dt>
        <dd class="font-medium"><%= @tea_product.user.name %></dd>
      </div>

      <div>
        <dt class="text-gray-500">ブランド</dt>
        <dd class="font-medium">
          <%= @tea_product.brand&.display_name || "未設定" %>
        </dd>
      </div>

      <div>
        <dt class="text-gray-500">茶葉タイプ</dt>
        <dd class="font-medium">
          <%= @tea_product.enum_i18n(:tea_type) %>
        </dd>
      </div>

      <div>
        <dt class="text-gray-500">カフェインレベル</dt>
        <dd class="font-medium">
          <%= @tea_product.enum_i18n(:caffeine_level) %>
        </dd>
      </div>

<!-- フレーバー：カテゴリごとに表示 -->
      <div class="sm:col-span-2">
        <dt class="text-gray-500">フレーバー</dt>
        <dd class="font-medium">
          <% if @tea_product.flavors.present? %>
            <% @tea_product.flavors.group_by(&:flavor_category).each do |category, flavors| %>
              <div class="mb-3">
                <div class="text-sm font-semibold text-gray-600 mb-1">
                  <%= category.name %>
                </div>
                <div class="flex flex-wrap gap-2">
                  <% flavors.each do |flavor| %>
                    <span class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-xs">
                      <%= flavor.name %>
                    </span>
                  <% end %>
                </div>
              </div>
            <% end %>
          <% else %>
            未設定
          <% end %>
        </dd>
      </div>

      <div class="sm:col-span-2">
        <dt class="text-gray-500">購入場所</dt>
        <dd class="font-medium">
          <% if @tea_product.purchase_locations.present? %>
            <div class="space-y-2">
              <% @tea_product.purchase_locations.each do |location| %>
                <div>
                  <span class="inline-block px-2 py-1 bg-gray-100 rounded text-xs mr-2">
                    <%= location.enum_i18n(:location_type) || "未設定" %>
                  </span>
                  <%= location.name %>
                </div>
              <% end %>
            </div>
          <% else %>
            未設定
          <% end %>
        </dd>
      </div>

      <div>
        <dt class="text-gray-500">ステータス</dt>
        <dd class="font-medium">
          <%= @tea_product.enum_i18n(:status) %>
        </dd>
      </div>
    </dl>
  </div>

  <!-- 説明 -->
  <div>
    <h3 class="text-lg font-semibold mb-2">説明</h3>
    <p class="text-sm text-gray-700 whitespace-pre-wrap">
      <%= @tea_product.description.presence || "説明なし" %>
    </p>
  </div>

  <!-- 承認情報（承認済みの場合） -->
  <% if @tea_product.published? || @tea_product.rejected? %>
    <div>
      <h3 class="text-lg font-semibold mb-2">承認情報</h3>
      <p class="text-sm text-gray-700">
        承認者：
        <%= @tea_product.approved_by&.name %><br>
        承認日時：
        <%= l(@tea_product.approved_at) %>
      </p>
    </div>
  <% end %>

  <!-- 操作 -->
  <div class="flex justify-between pt-4 border-t">

  <!-- 左側 -->
    <%= link_to "一覧に戻る",
          admin_root_path,
          class: "text-sm text-gray-600 hover:underline self-start" %>

    <% if @tea_product.pending? %>
      <!-- 右側 -->
      <div class="flex flex-col items-end gap-3">

        <%= button_to "承認",
            approve_admin_tea_product_path(@tea_product),
            method: :patch,
            class: "px-4 py-2 bg-green-600 text-white rounded" %>

        <%= form_with url: reject_admin_tea_product_path(@tea_product),
              method: :patch,
              local: true,
              class: "flex flex-col items-end gap-2" do |f| %>

          <%= text_area_tag :rejection_reason,
                nil,
                rows: 3,
                placeholder: "却下理由を入力してください",
                class: "w-64 border rounded p-2" %>

          <%= f.submit "却下",
              class: "px-4 py-2 bg-red-600 text-white rounded" %>
        <% end %>

      </div>
    <% end %>

  </div>

</div>
