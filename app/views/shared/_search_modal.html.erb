<div
  data-modal-target="overlay"
  class="hidden fixed inset-0 bg-[#365442]/60 backdrop-blur-sm flex items-center justify-center z-50 p-4">

  <div
    class="bg-white w-full
           max-w-sm sm:max-w-md md:max-w-lg lg:max-w-lg
           max-h-[85vh] overflow-y-auto
           rounded-lg border-2 border-[#B5A89A] shadow-2xl relative">

    <button
      data-action="click->modal#close"
      class="absolute top-4 right-4 text-[#8C7B6C] hover:text-[#365442] transition-colors p-2">
      <span class="text-2xl font-bold">✕</span>
    </button>

    <div class="p-8 sm:p-10">

      <div data-modal-target="flavorPanel" class="hidden">

        <div class="mb-8 border-b-2 border-[#F1EFE9] pb-4">
          <h2 class="text-xl font-serif font-bold text-[#365442] tracking-widest uppercase">
            FLAVOR NOTES
          </h2>
          <p class="text-[10px] text-[#8C7B6C] font-bold mt-1 uppercase tracking-widest">フレーバーから探す</p>
        </div>

        <div data-controller="flavor">
          <% @flavor_categories.each do |category| %>

            <div class="mb-4 border border-[#D6CEC5] rounded overflow-hidden">

              <div class="flex items-center justify-between bg-[#FDFBF9] p-3">

                <button
                  data-action="click->flavor#toggle"
                  class="text-[#365442] font-bold px-2 hover:scale-110 transition-transform">
                  ▽
                </button>

                <%= link_to category.name,
                  tea_products_path(
                    q: (params[:q]&.to_unsafe_h || {}).merge(
                      flavors_flavor_category_id_eq: category.id
                    )
                  ),
                  class: "font-bold text-[#365442] flex-1 ml-3 text-left hover:text-[#A75F29] transition-colors" %>

              </div>

              <div class="hidden bg-white border-t border-[#F1EFE9] p-3 pl-10 space-y-2">

                <% category.flavors.each do |flavor| %>
                  <%= link_to flavor.name,
                    tea_products_path(
                      q: (params[:q]&.to_unsafe_h || {}).merge(
                        flavors_id_eq: flavor.id
                      )
                    ),
                    class: "block py-1.5 text-sm font-bold text-[#5D554E] hover:text-[#A75F29] transition-colors relative before:content-[''] before:absolute before:-left-4 before:top-1/2 before:w-1.5 before:h-1.5 before:bg-[#D6CEC5] before:rounded-full before:-translate-y-1/2" %>
                <% end %>

              </div>

            </div>
          <% end %>
        </div>

      </div>

      <div data-modal-target="brandPanel" class="hidden">

        <div class="mb-8 border-b-2 border-[#F1EFE9] pb-4">
          <h2 class="text-xl font-serif font-bold text-[#365442] tracking-widest uppercase">
            BRANDS
          </h2>
          <p class="text-[10px] text-[#8C7B6C] font-bold mt-1 uppercase tracking-widest">ブランドから探す</p>
        </div>

        <div class="grid gap-2">
          <% @brands.each do |brand| %>
            <%= link_to tea_products_path(
                  q: (params[:q]&.to_unsafe_h || {}).merge(
                    brand_id_eq: brand.id
                  )
                ),
                class: "group block p-4 bg-[#FDFBF9] border-2 border-[#D6CEC5] rounded hover:border-[#365442] hover:bg-white transition-all shadow-sm" do %>

              <span class="text-base font-bold text-[#365442] group-hover:text-[#A75F29] flex items-center justify-between">
                <%= brand.name_ja || brand.name_en %>
                <span class="text-[#D6CEC5] group-hover:text-[#365442] text-xs">→</span>
              </span>

            <% end %>
          <% end %>
        </div>

      </div>
    </div>
  </div>
</div>